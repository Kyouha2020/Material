@use "sass:color"
@use "sass:map"
@use "../../design/color/light-theme" as *
@use "../../design/usability/accessibility" as *
@use "../../design/environment/elevation" as *
@use "../../design/interaction/states" as *
@use "../../design/layout/density" as *
@use "../../design/layout/spacing" as *
@use "../../design/shape/shape" as *
@use "../../design/typography/typography" as *
@use "../ripple/ripple" as *

@mixin button-container($container-color, $container-overlay, $elevation: 0, $elevation-scale: 2)
  @include ripple(rgba($container-overlay, $container-overlay--pressed))
  background-color: $container-color
  &:disabled
    @include elevation(0)
    background-color: rgba(color.grayscale($container-color), $disabled-filled-container)
  &.mtrl-button--choice
    background-color: color.mix($container-color, $container-overlay, 100% - $container-overlay--pressed)
  &:hover
    background-color: color.mix($container-color, $container-overlay, 100% - $container-overlay--hovered)
  &:focus
    background-color: color.mix($container-color, $container-overlay, 100% - $container-overlay--focused)
  &:active
    background-color: color.mix($container-color, $container-overlay, 100% - $container-overlay--pressed)
  @if $elevation != 0
    @include elevation($elevation)
    &:hover
      @include elevation($elevation + $elevation-scale)
    &:focus
      @include elevation($elevation + $elevation-scale * 2)
    &:active
      @include elevation($elevation + $elevation-scale * 3)

.shadow-container
  position: relative
  display: inline-flex
  filter: drop-shadow(0px 1px 1px rgba(0, 0, 0, 0.2))
  transition-property: filter

.mtrl-button
  @include typography(button)
  @include density(button)
  @include touch-target(button)
  @include shape(button)
  @include button-container($surface, $primary)
  @include color($primary, $text--high-emphasis)
  @include margin(1)
  @include padding(0, 2)
  min-width: 64px
  position: relative
  display: inline-flex
  align-items: center
  justify-content: center
  vertical-align: middle
  user-select: none
  white-space: nowrap
  border: none
  -webkit-tap-highlight-color: transparent
  transition: box-shadow 150ms

  &:not(:focus-visible)
    outline: none

  &:focus-visible
    overflow: hidden

  &:hover
    cursor: pointer

  &:disabled
    @include color($on-surface, $text--disabled)
    cursor: default
    pointer-events: none
    border-color: rgba($on-surface, $stroke)

  & > *
    position: relative


  @each $shape in (rounded, cut, scoop, notch, iphonex)
    &--#{$shape}-corners
      --border-shape: #{$shape}

      -webkit-mask-image: paint(corner-shape, filled)
      --corner-radius: 8px
      border-radius: 8px
      --corner-shape: var(--border-shape)

      &--outlined
        --border-color: #{$primary}

        --stroke-color: var(--border-color)
        --stroke-weight: 1px
        border-image: paint(corner-shape, outlined) 0 fill !important

  &--cut-corners-2
    -webkit-mask-image: paint(cut-corners, filled)
    --corner-radius: 0px 8px 8px 8px

    &--outlined
      --border-color: #{$primary}
      --border-width: 1px

      --stroke-color: var(--border-color)
      --stroke-weight: var(--border-width)
      border-image: paint(cut-corners, outlined) 0 fill

  &--smooth-corners
    width: 128px !important
    height: 128px !important
    -webkit-mask-image: paint(smooth-corners)
    --smooth-corners: 4

    &--1
      width: 128px !important
      height: 128px !important
      -webkit-mask-image: paint(smooth-corners)
      --smooth-corners: 1

  &--polygon
    -webkit-mask-image: paint(avatar-polygon)
    --avatar-sides: 8
    --avatar-angle: 0deg

  &--background
    background-image: url(https://css-houdini.rocks/posts/background-properties/lowpoly.jpg)
    list-style-image: url(https://css-houdini.rocks/posts/background-properties/lowpoly.jpg)
    --background-opacity: 0.5
    --background-rotate: 10deg
    --background-filter: hue-rotate(var(--hue-rotate)) grayscale(var(--grayscale)) blur(var(--blur))
    --blur: 0px
    --grayscale: 0%
    --hue-rotate: -50deg
    background-image: paint(background)


  &--outlined
    border: 1px solid rgba($on-surface, $stroke)
    @if tone($surface) == dark
      &:focus
        border-color: $primary

  &:is(.mtrl-button--outlined, .mtrl-button--contained)
    @include padding(0, 4)

  &--contained
    @include button-container($primary, white, 2)
    @include color($on-primary, $text--high-emphasis)

  &--vertical
    @include density(flat-button)
    @include padding(8, 4)
    flex-direction: column

    .mtrl-button__icon
      @include margin(0, 0, 2)

    .mtrl-button__label
      @include typography(button, 0.875)

    .mtrl-button__label + .mtrl-button__icon
      @include margin(2, 0, 0)

    &.mtrl-button--rounded
      @include shape(flat-button, $variant: rounded)
      @include padding(8, 6)

  &--choice
    @include shape(choice-button)
    @include button-container($surface, $on-surface)
    @include color($on-surface, $text--high-emphasis)
    @include padding(0, 4)
    border-bottom: 2px solid $on-surface

    &--active
      @include button-container($surface, $primary)
      @include color($primary, $text--high-emphasis)
      border-color: $primary

  &--rounded
    @include shape(button, $variant: rounded)

  &--block
    width: 100%

  &--transparent
    @include button-container(transparent, $primary)

  &--no-touch-target
    overflow: hidden


  &__label
    display: inline-flex
    align-items: center
    justify-content: center

    &--sentence-case
      text-transform: none

  &__icon
    @include margin-horizontal(-1, 2)
    width: 18px
    height: 18px
    font-size: 18px
    fill: currentColor

  &__label + &__icon
    @include margin-horizontal(2, -1)
